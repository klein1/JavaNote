## 上下文切换

CPU 利用时间片轮询来为每个任务服务一段时间，然后把当前任务的状态保存下来，继续服务下一个任务。任务的保存及再加载叫作线程的上下文切换。



**上下文：线程切换时 CPU 寄存器和程序计数器所保存的当前线程的信息。**

**寄存器：CPU 内部容量较小但速度很快的内存区域。**

**程序计数器：专用的寄存器，表明指令序列中 CPU 正在执行的位置。**



上下文切换过程中的信息会被保存在进程控制块（PCB）中。

PCB 在 CPU 内存中。



### 切换流程

1. 挂起一个进程，将该进程上下文信息存储于内存的 PCB 中。
2. 在 PCB 中检索下一个进程的上下文并将其在 CPU 的寄存器中恢复。
3. 跳转到程序计数器所指向的位置（被中断的代码行），并恢复该进程。



### 引起上下文切换原因

1. 当前任务完成
2. I/O 阻塞
3. 没有抢到锁资源
4. 用户代码挂起任务（sleep方法让出 CPU）
5. 硬件中断



## 线程、程序、进程

**程序**是含有指令和数据的文件，被存储在磁盘或其他的数据存储设备中，也就是说程序是静态的代码。

**进程**是程序的一次执行过程，是系统运行程序的基本单位，因此进程是动态的。系统运行一个程序即是一个进程从创建，运行到消亡的过程。

**一个进程就是一个执行中的程序。**

**线程**是一个比进程更小的执行单位。一个进程在其执行的过程中可以产生多个线程。与进程不同的是同类的多个线程共享进程的**堆**和**方法区**资源，但每个线程有自己的**程序计数器**、**虚拟机栈**和**本地方法栈**。



